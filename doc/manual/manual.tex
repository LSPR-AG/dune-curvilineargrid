%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%% objective - CSCS small project proposal
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%\documentclass[a4paper,twocolumn]{article}
%\documentclass[a4paper,10pt]{article}
\documentclass[12pt]{article}

\usepackage[sort&compress,super]{natbib}
\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
%\usepackage{subfigure}                                %% for creating nested figures within figures
\usepackage{graphicx}
\usepackage{url}
\usepackage{array}
\usepackage{algorithm,algorithmic}
\usepackage{tikz}
\usepackage{url}  
\usetikzlibrary{arrows}
\usetikzlibrary{mindmap,trees}
\usepackage[overlay,absolute]{textpos}
%\usepackage[latin1]{inputenc}
\usepackage{wrapfig}
\usepackage{makeidx}
\usepackage{listings}
\usepackage{color}
\usepackage{xcolor}



% Rounded boxes functionality
\usepackage[framemethod=tikz]{mdframed}
\definecolor{mycolor}{rgb}{0.122, 0.435, 0.698}

\newmdenv[innerlinewidth=0.5pt, roundcorner=4pt,linecolor=mycolor, backgroundcolor=lightgray, innerleftmargin=6pt,
innerrightmargin=6pt,innertopmargin=6pt,innerbottommargin=6pt]{mybox}



%\usepackage[colorlinks,linkcolor=blue,anchorcolor=blue,citecolor=green]{hyperref} % hyper reference to contents 

\citestyle{plain}

\makeindex



% The following parameters seem to provide a reasonable page setup.
\topmargin 0.0cm
\oddsidemargin 0.2cm
\textwidth 16.1cm 
\textheight 21cm
\footskip 1.0cm



\begin{document}

\lstset{language=C++, breaklines=true}



\begin{titlepage}




\begin{center}
    
\noindent \textsc{{\Large Dune-CurvilinearGrid}}

\vspace{5mm}

\noindent \textbf{\textsc{{\Large Parallel grid for unstructured tetrahedral curvilinear meshes}}}
  
\vspace{2mm}
    
{\large
    
\noindent Aleksejs Fomins$^{\mathrm{a,b}}$ and Benedikt Oswald$^{\mathrm{b}}$

  }

\vspace{1mm}

\noindent $^{\mathrm{a}}$ Nanophotonics and Metrology Laboratory (\texttt{nam.epfl.ch})
\noindent Ecole Polytechnique F\'ederale de Lausanne (EPFL)
  
\vspace{1mm}

\noindent $^{\mathrm{b}}$ LSPR AG, Technopark Z\"urich, Technoparkstrasse 1, CH-8005 Z\"urich
\noindent phone +41 43 366 90 74 - email: \texttt{aleksejs.fomins@lspr.ch} and \texttt{benedikt.oswald@lspr.ch}

\vspace{2mm}

\end{center}










%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% BEGIN OF ABSTRACT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\vfill

\noindent \textbf{\textsc{ABSTRACT}} - We introduce the \texttt{dune-curvilineargrid} module. The module provides the self-contained, parallel
grid manager \texttt{dune-curvilineargrid} for curvilinear tetrahedral elements up to $5^{\mathrm{th}}$  order and conforms to the \text{DUNE} grid API.
%%
In particular, \texttt{dune-curvilineargrid} is a grid manager in its own right which offers this functionality:
%%
%%
\textbf{(1)} fully parallel mesh input in the \texttt{Gmsh} mesh format, thus we achieve the scalable input of very large meshes;
i.e. when a large mesh is read from disk, every process in the parallel context reads a small piece of the mesh; thus, we avoid the
scalability bottleneck that would arise if the whole mesh were read on the master process and then communicated to other processes;
the latter approach would inevitably lead to memory congestion on the master node and crash the program;
%%
%%
\textbf{(2)} once the mesh has been read from disk, it is partitioned using the \texttt{Parmetis} graph partitioning tool;
%%
%%
\textbf{(3)} \texttt{dune-curvilineargrid} manages meshes that consist of tetrahedra with curvilinear faces and edges, up to
$5^{\mathrm{th}}$ order; the curvilinear mesh geometry is modelled through \textit{Lagrange} polynomials of the respective order;
%%
%%
\textbf{(4)} since \texttt{dune-curvilineargrid} is a fully parallel grid manager for distributed memory architectures, it provides
globally unique indices over all processes in the parallel context.
%%
%%
\textbf{(5)} the \texttt{dune-curvilineargrid} fully parallel grid manager provides ghost elements associated with the interprocessor
boundaries;
%%
%%
\textbf{(5)} the \texttt{dune-curvilineargrid} grid manager provides communication protocols via the standard
\text{DUNE} data handle interface for all codimensions; i.e. data associated with vertices, edges, faces and volumes can
be communicated.
%%
%%
The \texttt{dune-curvilineargrid} fully parallel grid manager is publicly available via \texttt{Github}
and free software based on the GPLv2 license. Other licenses can be negotiated through
\texttt{benedikt.oswald@lspr.ch}.
%%
%%
The \texttt{dune-curvilineargrid} grid manager is continously developed and improved. Among other things, we are working
on local refinement, modelling hanging nodes, non-uniform curvilinear order, periodicity and internal boundaries which
may become interesting for the implementation of hybrid finite-element-boundary-integral (FEBI) discretisation schemes.





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% END OF ABSTRACT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{titlepage}




\section{Introduction}

\section{Outline}
\subsection{Capabilities}

\noindent
Currently the curvilinear grid supports the following functionality.
\begin{itemize}
	\item Self-consistent grid manager supporting 3D tetrahedral curvilinear grids.
	\item GMSH input files of curvilinear orders 1-5. Usual linear geometries also supported
	\item Parallel mesh reader with scalability for large meshes and processors
	\item Mesh partitioning using ParMetis \textbf{CITE}
	\item Unique physical tag for each element and domain boundary. Read from GMSH file and accessible via grid methods.
	\item Unique global index for entities of all codimensions.
	\item Ghost elements of all codimensions (optional)
	\item Communication protocols for all codimensions
\end{itemize}

\noindent
The following functionality is currently NOT supported. As seen below, some of this functionality will be implemented in the nearest future, some other is not currently foreseen. We welcome contributions from the community
\begin{itemize}
	\item $[1-2 months]$ Location of containing element by global coordinate (via OCTree)
	\item $[1/2 year]$  Does NOT support global and local refinement
	\item $[1/2 year]$  Does NOT support hanging nodes
	\item $[1/2 year]$  Does NOT support periodic boundaries at the moment
	\item $[1 year]$    Does Not support curvilinear meshes of non-uniform order
	\item $[Undefined]$ Does NOT support 1D and 2D geometries. 
	\item $[Undefined]$ Does NOT support non-tetrahedral meshes.
	\item $[Undefined]$ Does NOT support front/overlap elements at the moment
\end{itemize}

\subsection{Design decisions}

\begin{itemize}
	\item User must provide globalId's for vertices and elements. [Automatically implemented by GMSH]
	\item User must provide all boundary segments inside GMSH file.
\end{itemize}


\subsection{Internal Structure}

\begin{itemize}
	\item CurvilinearGMSHReader
	\item CurvilinearVTKWriter
	\item CurvilinearGridBase
		\subitem CurvilinearGridStorage
		\subitem CurvilinearGridConstructor
	\item CurvilinearGrid
	\item CurvilinearGridHowto
	
\end{itemize}











\section{Usage (Curvilinear Grid How-to)}
In order to learn the workings of curvilinear grid it is easiest to study the source code of relevant tutorials \index{tutorial} provided inside the curvilinear grid module.

\subsection{Tutorial 1 - Getting started}

In this tutorial we will create a Curvilinear Grid by reading it from a GMSH file. This and all other tutorials can be run both in serial and in parallel.
First we define the grid \\

\begin{mybox}
\begin{lstlisting}
  typedef Dune::CurvilinearGrid<dim, dimworld, ctype> GridType;
\end{lstlisting}
\end{mybox}

\noindent
where $dim=3$ and $dimworld=3$ are dimensions of the grid and the world containing the grid. Currently this is the only allowed setup. \\

\noindent
Afterwards, we construct the Curvilinear Grid Factory \\

\begin{mybox}
\begin{lstlisting}
  Dune::CurvilinearGridFactory<ctype, dimworld> factory(withGhostElements, verbose, processVerbose, mpihelper);
\end{lstlisting}
\end{mybox}

\noindent
where $bool\ withGhostElements$ defines whether the Ghost Elements will be constructed. $bool\ verbose,\ processVerbose$ determine the master process and all other processes would write the debug output. \\

\noindent
Then the Parallel Curvilinear GMSH Reader is used to read the mesh into the factory. \\

\begin{mybox}
\begin{lstlisting}
    Dune::CurvilinearGmshReader< GridType >::read(factory, filename, mpihelper, verbose, processVerbose, writeReaderVTKFile, insertBoundarySegment); 
\end{lstlisting}
\end{mybox}

\noindent
where $filename$ is the name of the $.msh$ file. $bool\ writeReaderVTKFile$ option allows to write the mesh to parallel VTU files immediately after reading. $bool\ insertBoundarySegment$ enables inserting boundary segments from the GMSH file. Currently the switch must be true, and $.msh$ file must contain all boundary segments for the grid to work. \\

\noindent
Finally, the factory is used to create the grid and return a pointer to it
\begin{mybox}
\begin{lstlisting}
  factory.createGrid();
\end{lstlisting}
\end{mybox}


\subsection{Tutorial 2 - Traverse}

\subsection{Tutorial 3 - Visualisation}






\section{Diagnostics tools}
\subsection{Mesh statistics}
\subsection{Visualisation}

\section{Implementation details}
\subsection{Parallel GMSH reader}
\subsection{Partitioning}
\subsection{Global index construction}
\subsection{Ghost element construction}
\subsection{Communication interface construction}

%\bibliographystyle{plainnat}
%\bibliography{oswald,numerical_libraries,molecular_plasmonics,finite_element_method,electromagnetic}


\printindex

\end{document}